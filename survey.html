<!DOCTYPE html>
<html>

<head>
    <title>Architecture Survey</title>
    <meta http-equiv="pragma" content="no-cache">
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <link href="https://unpkg.com/jspsych@7.3.1/css/jspsych.css" rel="stylesheet" type="text/css" />
    <script src="https://unpkg.com/jspsych@7.3.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-button-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-categorize-image@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-fullscreen@1.2.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-slider-response@1.1.2"></script> 
    <script src="https://unpkg.com/@jspsych/plugin-survey-likert@1.1.2"></script>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js'></script>
    <script src="util.js"></script>
</head>

<body></body>

<script>
    // Initialize the jsPsych object (possibly with arguments: https://www.jspsych.org/7.3/reference/jspsych/)
    var jsPsych = initJsPsych({
        on_finish: function () {
            jsPsych.data.displayData(); // Print data to screen at the end
            write_data_to_server(); // This function is defined in `util.js`
        },
        show_progress_bar: true,
    });

    // The `write_data_to_server` function requires two global variables to be defined:
    // `url_write_data_php` (web location of the write_data.php script) and `output_filename`
    var url_experiment_dir = 'https://kxzheng.scripts.mit.edu/architecture-survey/'; // CHANGE
    var url_write_data_php = url_experiment_dir + 'write_data.php';

    // randomize subject id
    var subject_id = jsPsych.data.getURLVariable('subject_id');
    console.log(`subject_id from URL: ${subject_id}`);
    if (!subject_id) {
        subject_id = jsPsych.randomization.randomID(10);
        console.log(`subject_id randomly assigned: ${subject_id}`);
    }

    // save output file
    var output_filename = `data/experiment3_${subject_id}.json`;
    console.log(`Data will be saved to: ${url_experiment_dir + output_filename}`);

    // Initialize a timeline (just an empty array)
    var timeline = [];

    // A preload object will ensure images are loaded from the server before the trial they are used
    var preload = {
        type: jsPsychPreload,
        auto_preload: true,
    };
    timeline.push(preload);

    // Always good to put experiment instructions /  disclaimers on the first page
    var first_page = {
        type: jsPsychHtmlButtonResponse, // This trial will use the "html-button-response" plugin
        stimulus: [
            '<h2>Architecture Preference Survey</h2>' +
            '<p>In this survey, we hope to learn more about your archectural preferences. Your task is to compare different structures and/or rate them. We are doing this solely for the sake of curiosity, feel free to reach out to learn more. </p>' +
            '<p>Contacts: kxzheng@mit.edu, iyu@mit.edu </p>'
        ],
        choices: ['Begin'],
    };

    var enter_fullscreen = {
        type: jsPsychFullscreen,
        fullscreen_mode: true,
        message: '<p>This survey will switch to full screen mode when you press the button below.</p>'
    }

    timeline.push(first_page,enter_fullscreen);

    var attention_trial = {
        type: jsPsychHtmlButtonResponse, // This trial will use the "html-button-response" plugin
        stimulus: [
            '<p>Please repeat the instructions.</p>'
        ],
        choices: ['Continue'],
    }

    ///// questions about stability, cost, and aesthetics 
    var comparison_questions = [`<p>Play the following videos: which building is more likely to collapse during an earthquake? </p>
                                <p><small>Select 1 if the left building is more likely to collapse, 
                                2-6 for in between, and 7 if the right building is more likely to collapse. Note that all blocks are the same size. </small></p>`,
                                `<p>Play the following videos: which building seems more expensive cost wise to construct? </p>
                                <p><small>Select 1 if the left building seems more expensive,
                                2-6 for in between, and 7 if the right building seems more expensive. Note that all blocks are the same size. </small></p>`,
                                `<p>Play the following videos: which building's appearance do you prefer aesthetically'? </p>
                                <p><small>Select 1 if the left building is more aesthetic, 
                                2-6 for in between, and 7 if the right building is more aesthetic. Note that all blocks are the same size.</small></p>`
                            ];
    
    var left_video_path = `videos/t_tower/t_towers0.mp4`;
    var right_video_path = `videos/t_tower/t_towers3.mp4`;

    var comparison_trial_likert = {
        type: jsPsychSurveyLikert,
        preamble: `${comparison_questions[0]}` + // alterate this question line
                    `<div id="wrapper"> 
                    <video id="videoleft" width="400" height="300" poster="images/video.jpg" controls="controls" preload="none" disablepictureinpicture controlsList="nofullscreen nodownload noremoteplayback noplaybackrate"> 
                        <source type="video/mp4" src="videos/t_tower/t_towers0.mp4" ${left_video_path} /> 
                    </video>
                    <video id="videoright" width="400" height="300" poster="images/video.jpg" controls="controls" preload="none" disablepictureinpicture controlsList="nofullscreen nodownload noremoteplayback noplaybackrate"> 
                        <source type="video/mp4" src="videos/t_tower/t_towers5.mp4" ${right_video_path}}/> 
                    </video>
                    <div class="clear"></div> 
                </div>`,
        questions: [
            {
            prompt: '',//"I like vegetables.", 
            labels: ['1 (Left)','2','3','4','5','6','7 (Right)']
            }
        ]
        };

    var comparison_trial = {
        type: jsPsychHtmlSliderResponse,
        stimulus: `${comparison_questions[0]}` + // alterate this question line
                    `<div id="wrapper"> 
                    <video id="videoleft" width="400" height="300" poster="images/video.jpg" controls="controls" preload="none" disablepictureinpicture controlsList="nofullscreen nodownload noremoteplayback noplaybackrate"> 
                        <source type="video/mp4" src="videos/t_tower/t_towers0.mp4" ${left_video_path} /> 
                    </video>
                    <video id="videoright" width="400" height="300" poster="images/video.jpg" controls="controls" preload="none" disablepictureinpicture controlsList="nofullscreen nodownload noremoteplayback noplaybackrate"> 
                        <source type="video/mp4" src="videos/t_tower/t_towers5.mp4" ${right_video_path}}/> 
                    </video>
                    <div class="clear"></div> 
                </div>`,
        max: 60,
        step: 10,
        require_movement: true,
        labels: ['1 (Left)','2','3','4','5','6','7 (Right)']
        };

    timeline.push(comparison_trial);

    ///// question about materials 
    var mat_video_path = `videos/t_tower/t_towers0.mp4`;
    var material_trial = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `
                    <p>What material should thia building be made from for most longevity?</p> 
                    <video id="videoleft" width="500" poster="images/video.jpg" controls="controls" preload="none" disablepictureinpicture controlsList="nofullscreen nodownload noremoteplayback noplaybackrate"> 
                        <source type="video/mp4" src="videos/t_tower/t_towers0.mp4" ${mat_video_path} /> 
                    </video>`,
        choices: ['Wood', 'Metal', 'Glass', 'Brick', 'Concrete'],
        prompt: ""
        };
    
    timeline.push(material_trial);

    // // Define some variables that will be shared across all image trials
    // var prompt_str = 'Was the person pictured correctly wearing a face mask?';
    // var choices = ['Correctly wearing mask', 'Incorrectly wearing mask', 'Not wearing mask'];
    // var maintain_aspect_ratio = true;
    // var stimulus_width = 300; // Image width in pixels (null will use native width)
    // var stimulus_duration = 500; // Image presentation duration in ms

    // Programatically prepare a list of variables that will vary by trials
    var timeline_variables_for_trials = [];
    var factors = {
        condition: [0, 1, 2], // 3 conditions numbered 0, 1, 2
        image_num: arange(50, 53, 1), // 3 images numbered 50 to 52
    };
    var full_design = jsPsych.randomization.factorial(factors, 1);
    var unique_stimulus_duration = [250, 750];
    var list_stimulus_duration = jsPsych.randomization.repeat(
        unique_stimulus_duration,
        full_design.length / unique_stimulus_duration.length);
    for (var itr_trial = 0; itr_trial < full_design.length; itr_trial += 1) {
        var condition = full_design[itr_trial].condition;
        var image_num = full_design[itr_trial].image_num;
        timeline_variables_for_trials.push({
            image_path: `images/condition${condition}/${image_num}.png`,
            stimulus_duration: list_stimulus_duration[itr_trial],
            key_answer: `${condition}`,
        });
    }
    console.log(full_design);
    console.log(JSON.stringify(timeline_variables_for_trials));

    // programatically make trials
    var tt_timeline_variables = [];
    var t_towers = arange(0, 5, 1);


    example_stim = `<div style="width:500px;">
                <p>How likely is it that team A will win this match?</p>
                <div style="width:240px; float: left;">
                    <p>TEAM A</p>
                    <p>10 wins, 5 losses, 6 draws</p>
                </div>
                <div style="width:240px; float: right;">
                    <p>TEAM B</p>
                    <p>6 wins, 4 losses, 11 draws</p>
                </div>
                </div>`

    

    // Prepare timeline for the individual trials
    var timeline_for_trials = [
        // {
        //     type: jsPsychImageButtonResponse, // This trial will use the "image-button-response" plugin
        //     stimulus: jsPsych.timelineVariable('image_path'),
        //     maintain_aspect_ratio: maintain_aspect_ratio,
        //     stimulus_width: stimulus_width,
        //     stimulus_duration: jsPsych.timelineVariable('stimulus_duration'),
        //     prompt: prompt_str,
        //     choices: choices,
        //     data: {
        //         stimulus_duration: jsPsych.timelineVariable('stimulus_duration'),
        //     },
        // },
        {
            type: jsPsychHtmlSliderResponse,
            //prompt: prompt_str,
            stimulus: `
                    <p>How likely is it that team A will win this match?</p>
                    <div id="wrapper"> 
                    <video id="home1" width="400" height="300" poster="images/video.jpg" controls="controls" preload="none"> 
                        <source type="video/mp4" src="videos/t_tower/t_towers0.mp4" /> 
                    </video>
                    <video id="home2" width="400" height="300" poster="images/video.jpg" controls="controls" preload="none"> 
                        <source type="video/mp4" src="videos/t_tower/t_towers5.mp4" /> 
                    </video>
                    <div class="clear"></div> 
                </div>`,
            min: 0,
            max: 7,
            require_movement: true,
            labels: ['1 (Left Tower)','2','3','4','5','6','7 (Right Tower)']
        },

        // {
        //     type: jsPsychCategorizeImage, // This trial will use the "categorize-image" plugin
        //     stimulus: jsPsych.timelineVariable('image_path'),
        //     maintain_aspect_ratio: maintain_aspect_ratio,
        //     stimulus_width: stimulus_width,
        //     stimulus_duration: jsPsych.timelineVariable('stimulus_duration'),
        //     prompt: [
        //         '<h3>0 = No mask</h3>' +
        //         '<h3>1 = Mask worn correctly</h3>' +
        //         '<h3>2 = Mask worn incorrectly</h3>'
        //     ],
        //     choices: ['0', '1', '2'],
        //     show_stim_with_feedback: false,
        //     feedback_duration: 1000,
        //     correct_text: 'Correct',
        //     incorrect_text: 'The correct response was %ANS%',
        //     text_answer: jsPsych.timelineVariable('key_answer'),
        //     key_answer: jsPsych.timelineVariable('key_answer'),
        //     data: {
        //         key_answer: jsPsych.timelineVariable('key_answer'),
        //         stimulus_duration: jsPsych.timelineVariable('stimulus_duration'),
        //     },
        // },
    ];

    // Add the trials to the main timeline
    var trials = {
        timeline: timeline_for_trials,
        timeline_variables: timeline_variables_for_trials,
        randomize_order: true,
    };
    // timeline.push(trials);

    var last_page = {
        type: jsPsychHtmlButtonResponse, // This trial will use the "html-button-response" plugin
        stimulus: [
            '<h2>Press the button below to end.</h2>' +
            '<p>Thank you for participating!</p>'
        ],
        choices: ['End survey'],
    };
    timeline.push(last_page);

    // Run the timeline
    jsPsych.run(timeline);
</script>

</html>